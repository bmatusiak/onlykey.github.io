<html>

<head>
    <title>OnlyKey Web Apps - Search for Keybase users</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/jqueryui-editable/css/jqueryui-editable.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/jqueryui-editable/js/jqueryui-editable.min.js"></script>
    <!-- CSSNormalize, CSSGrids-Responsive, CSSForm, CSSTable, CSSList (v3.9.1) -->
    <link rel="stylesheet" href="css/gallerycss-csstable-min.css">
    <link rel="stylesheet" href="css/gallerycss-csslist-min.css">
    <link rel="stylesheet" href="css/gallerycss-cssform-min.css">
    <link rel="stylesheet" href="css/cssnormalize-min.css">
    <link rel="stylesheet" href="css/cssgrids-responsive-min.css">
    <link rel="stylesheet" href="css/cssbutton-min.css">

    <!-- Some custom styles to make things pretty. -->
    <link rel="stylesheet" type="text/css" href="css/ui.css">

    <!-- pgp2go styles -->
    <link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous">
    <link href="css/ShareTechMono.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <!-- Modify header colors here to customize the look and feel of the site-->
    <style>
        .header {
            background: white;
        }

        .header h1 {
            color: rgb(97, 97, 97);
        }

        .header h2 {
            font-weight: 300;
            margin: 0;
            color: rgb(137, 137, 137);
        }
        
        .block{
          background-color: white;
        }
        .block-inner{
          padding: 12px;
          width: auto;
        }
        .outline{
          border: solid 2px #c9c9c9;
          transition: border 0.4s;
          outline: none;
          /*width: auto;*/
        }
    </style>

    <script>
    /* global $ */
    
    function searchKeybase(sites, user) {
      console.info("sites");
      console.info(sites);
      console.info("user");
      console.info(user);
      $("#results").html("");
      
      
      
      
      switch(sites.q) {
        //https://keybase.io/_/api/1.0/user/lookup.json?uid=4a4f61cdab6a13fb904599ef0159bd19
        
        case 'keybase': var kburl='https://keybase.io/_/api/1.0/user/user_search.json?q='+user.q;
        $.ajax({
          url: kburl,
          async: true,
          dataType: 'json',
          success: function(data) {
            console.info(data);
            var result=data.list;
            result.forEach(function(element) {
              console.log(element);
              console.log(element.components);
              var listItem=element.keybase;
              
              if(listItem.uid){
                $.ajax({
                  url: 'https://keybase.io/_/api/1.0/user/lookup.json?uid='+listItem.uid,
                  async: true,
                  dataType: 'json',
                  success: function(data) {
                    console.log(data)
                    if (listItem.username) {
                      var outDiv=$("<div class='outline'>");
                      $("#results").append(outDiv);
                      var leftDiv_outter=$("<div class='yui3-u-1-2'>");
                      outDiv.append(leftDiv_outter);
                      var rightDiv_outter=$("<div class='yui3-u-1-2'>");
                      outDiv.append(rightDiv_outter);
                      var leftDiv=$("<div class='block-inner'>");
                      leftDiv_outter.append(leftDiv);
                      var rightDiv=$("<div class='block-inner'>");
                      rightDiv_outter.append(rightDiv);
                      
                      if (listItem.picture_url !=null) leftDiv.append("<img src='"+listItem.picture_url+"' width='10' height='auto'/><br>");
                      rightDiv.append("<font color='red'>Keybase Username = "+listItem.username+"</font><br>");
                      if (listItem.full_name) rightDiv.append("Full Name = "+listItem.full_name+"<br><br>");
                      rightDiv.append("View Keybase Profile <a href='https://keybase.io/"+listItem.username+"'>Here</a><br>");
                      rightDiv.append("Send Encrypted <a href='/encrypt-dev.html?type=e&recipients="+listItem.username+"'>Message</a> <a href='/encrypt-file-dev.html?type=e&recipients="+listItem.username+"'>File</a><br>");
            
                      for(var i in element.services_summary) {
                        rightDiv.append("<font color='blue'>"+element.services_summary[i].service_name.toUpperCase() +" Username = "+element.services_summary[i].username+"</font><br>");
                      }
                      var $getpgp_btn=$("<button>Copy PGP Key</button>");
                      var $pgp_copybox=$("<textarea>&nbsp;</textarea>");
                      rightDiv.append($getpgp_btn);
                      rightDiv.append($pgp_copybox);
                      $pgp_copybox.hide();
            
                      $getpgp_btn.click(function() {
                        
                        var url = 'https://keybase.io/'+listItem.username+'/pgp_keys.asc';
                        fetch(url).then(response => response.text()).then(response_text  => {
                          $pgp_copybox.val(response_text)
                          $pgp_copybox.show();
                          // $pgp_copybox.show();
                          // setTimeout(()=>{
                            $pgp_copybox.focus();
                            $pgp_copybox.select();
                            var successful=document.execCommand('copy');
                            $pgp_copybox.hide();
                            console.log("successful", successful);
                          // },1)
                          var origTxt = $getpgp_btn.text();
                          $getpgp_btn.text(origTxt + " (copied)");
                          setTimeout(()=>{$getpgp_btn.text(origTxt);},5000);
                        });
        
                      });
            
                    }
                
                
                  }});
              }
              // else {
              //   $("#results").append("<br>No matchs found!");
              // }
            }
            );
          }
        }
        );
        break;
        case 'protonmail' : break;
      
      }

/*
      if (sites.q=='auto') {
        var kburl ='https://keybase.io/_/api/1.0/user/user_search.json?q='+user.q;
        //var kburl = 'https://keybase.io/_/api/1.0/user/autocomplete.json?q=' + user.q;
        
        $.ajax({
            url: kburl,
            async: true,
            dataType: 'json',
            success: function(data) {
                console.info(data);
                var result = data.list;
                result.forEach(function(element) {
                  console.log(element);
                  console.log(element.components);
                  var listItem = element.keybase;
                  
                  if (listItem.username) {
                    var outDiv = $("<div class='outline'>");
                    $("#results").append(outDiv);
                    
                    
                    var leftDiv_outter = $("<div class='yui3-u-1-2'>");
                    outDiv.append(leftDiv_outter);
                    var rightDiv_outter  = $("<div class='yui3-u-1-2'>");
                    outDiv.append(rightDiv_outter);
                    
                    var leftDiv = $("<div class='block-inner'>");
                    leftDiv_outter.append(leftDiv);
                    
                    
                    
                    var rightDiv = $("<div class='block-inner'>");
                    rightDiv_outter.append(rightDiv);
                    
                    // $("#results").append("<br>Found a Match!");
                    
                    
                    
                    if (listItem.picture_url != null) leftDiv.append("<img src='"+listItem.picture_url+"' width='10' height='auto'/><br>");
                    rightDiv.append("<font color='red'>Keybase Username = "+listItem.username+"</font><br>");
                    if (listItem.full_name) rightDiv.append("Full Name = "+listItem.full_name+"<br><br>");
                    rightDiv.append("View Keybase Profile <a href='https://keybase.io/"+listItem.username+"'>Here</a><br>");
                    rightDiv.append("Send Encrypted <a href='/encrypt-dev.html?type=e&recipients="+listItem.username+"'>Message</a> <a href='/encrypt-file-dev.html?type=e&recipients="+listItem.username+"'>File</a><br>");
                    
                    for(var i in element.services_summary){
                      rightDiv.append("<font color='blue'>"+element.services_summary[i].service_name.toUpperCase() +" Username = "+element.services_summary[i].username+"</font><br>");
                    
                    }
                    
                    //data = JSON.stringify(data);
                  } else {
                    $("#results").append("<br>No matchs found!");
                  }
                });
            }
        });
      }
      
      
      else if (sites.q=='twitter') {

        $.ajax({
            url: 'https://keybase.io/_/api/1.0/user/discover.json?' + sites.q + '=' + user.q,
            async: true,
            dataType: 'json',
            success: function(data) {
              console.info(data);
                var result = data.matches.twitter[0][0];
                if (result.username) {
                  $("#results").append("<br>Found a Match!");
                  if (result.thumbnail != null) $("#results").append("<img src='"+result.thumbnail+"' width='10' height='auto'/><br>");
                  $("#results").append("<font color='red'>Keybase Username = "+result.username+"</font><br>");
                  if (result.full_name != null) $("#results").append("Full Name = "+result.full_name+"<br><br>");
                  $("#results").append("View this user's profile <a href='https://keybase.io/"+result.username+"'>here</a><br>");
                  $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-dev.html?type=e&recipients="+result.username+"'>message</a><br>");
                  $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-file-dev.html?type=e&recipients="+result.username+"'>file</a><br>");                  //data = JSON.stringify(data);
                } else {
                  $("#results").append("<br>No match found!");
                }
            }
        });
      } else if (sites.q=='github') {

        $.ajax({
            url: 'https://keybase.io/_/api/1.0/user/discover.json?' + sites.q + '=' + user.q,
            async: true,
            dataType: 'json',
            success: function(data) {
              console.info(data);
                var result = data.matches.github[0][0];
                if (result.username) {
                  $("#results").append("<br>Found a Match!");
                  if (result.thumbnail != null) $("#results").append("<img src='"+result.thumbnail+"' width='10' height='auto'/><br>");
                  $("#results").append("<font color='red'>Keybase Username = "+result.username+"</font><br>");
                  if (result.full_name != null) $("#results").append("Full Name = "+result.full_name+"<br><br>");
                  $("#results").append("View this user's profile <a href='https://keybase.io/"+result.username+"'>here</a><br>");
                  $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-dev.html?type=e&recipients="+result.username+"'>message</a><br>");
                  $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-file-dev.html?type=e&recipients="+result.username+"'>file</a><br>");                  //data = JSON.stringify(data);
                } else {
                  $("#results").append("<br>No match found!");
                }
            }
        });
      } else if (sites.q=='reddit') {

          $.ajax({
              url: 'https://keybase.io/_/api/1.0/user/discover.json?' + sites.q + '=' + user.q,
              async: true,
              dataType: 'json',
              success: function(data) {
                console.info(data);

                  var result = data.matches.reddit[0][0];
                  if (result.username) {
                    $("#results").append("<br>Found a Match!");
                    if (result.thumbnail != null) $("#results").append("<img src='"+result.thumbnail+"' width='10' height='auto'/><br>");
                    $("#results").append("<font color='red'>Keybase Username = "+result.username+"</font><br>");
                    if (result.full_name != null) $("#results").append("Full Name = "+result.full_name+"<br><br>");
                    $("#results").append("View this user's profile <a href='https://keybase.io/"+result.username+"'>here</a><br>");
                    $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-dev.html?type=e&recipients="+result.username+"'>message</a><br>");
                    $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-file-dev.html?type=e&recipients="+result.username+"'>file</a><br>");                  //data = JSON.stringify(data);
                  } else {
                    $("#results").append("<br>No match found!");
                  }
              }
          });
        } else if (sites.q=='web') {

            $.ajax({
                url: 'https://keybase.io/_/api/1.0/user/discover.json?' + sites.q + '=' + user.q,
                async: true,
                dataType: 'json',
                success: function(data) {
                  console.info(data);
                    var result = data.matches.web[0][0];
                    if (result.username) {
                      $("#results").append("<br>Found a Match!");
                      if (result.thumbnail != null) $("#results").append("<img src='"+result.thumbnail+"' width='10' height='auto'/><br>");
                      $("#results").append("<font color='red'>Keybase Username = "+result.username+"</font><br>");
                      if (result.full_name != null) $("#results").append("Full Name = "+result.full_name+"<br><br>");
                      $("#results").append("View this user's profile <a href='https://keybase.io/"+result.username+"'>here</a><br>");
                      $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-dev.html?type=e&recipients="+result.username+"'>message</a><br>");
                      $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-file-dev.html?type=e&recipients="+result.username+"'>file</a><br>");                  //data = JSON.stringify(data);
                    } else {
                      $("#results").append("<br>No match found!");
                    }
                }
            });
          } else if (sites.q=='key_fingerprint') {

              $.ajax({
                  url: 'https://keybase.io/_/api/1.0/user/discover.json?' + sites.q + '=' + user.q,
                  async: true,
                  dataType: 'json',
                  success: function(data) {
                    console.info(data);
                      var result = data.matches.key_fingerprint[0][0];
                      if (result.username) {
                        $("#results").append("<br>Found a Match!");
                        if (result.thumbnail != null) $("#results").append("<img src='"+result.thumbnail+"' width='10' height='auto'/><br>");
                        $("#results").append("<font color='red'>Keybase Username = "+result.username+"</font><br>");
                        if (result.full_name != null) $("#results").append("Full Name = "+result.full_name+"<br><br>");
                        $("#results").append("View this user's profile <a href='https://keybase.io/"+result.username+"'>here</a><br>");
                        $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-dev.html?type=e&recipients="+result.username+"'>message</a><br>");
                        $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-file-dev.html?type=e&recipients="+result.username+"'>file</a><br>");                  //data = JSON.stringify(data);
                      } else {
                        $("#results").append("<br>No match found!");
                      }
                  }
              });
            } else if (sites.q=='hackernews') {

              $.ajax({
                  url: 'https://keybase.io/_/api/1.0/user/discover.json?' + sites.q + '=' + user.q,
                  async: true,
                  dataType: 'json',
                  success: function(data) {
                    console.info(data);
                      var result = data.matches.hackernews[0][0];
                      if (result.username) {
                        $("#results").append("<br>Found a Match!");
                        if (result.thumbnail != null) $("#results").append("<img src='"+result.thumbnail+"' width='10' height='auto'/><br>");
                        $("#results").append("<font color='red'>Keybase Username = "+result.username+"</font><br>");
                        if (result.full_name != null) $("#results").append("Full Name = "+result.full_name+"<br><br>");
                        $("#results").append("View this user's profile <a href='https://keybase.io/"+result.username+"'>here</a><br>");
                        $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-dev.html?type=e&recipients="+result.username+"'>message</a><br>");
                        $("#results").append("Send this user encrypted <a href='https://apps.crp.to/dev-new/encrypt-file-dev.html?type=e&recipients="+result.username+"'>file</a><br>");                  //data = JSON.stringify(data);
                      } else {
                        $("#results").append("<br>No match found!");
                      }
                  }
              });
            }
*/
      }

    $(document).ready(function() {
    $('#submit').click(function() {

        var sites = {
            q: $("#sites option:selected").val(),
            rpp: 5
        };
        var users = {
            q: $('#user').val(),
            rpp: 5
        };
        searchKeybase(sites, users);
    });
    });
    </script>
</head>
<body class="yui3-skin-sam">
    <div id="headerMenu" class="yui3-menu yui3-menu-open yui3-menu-horizontal yui3-menu-fixed">
      <span class="yui3-menu-heading">Apps</span>
      <ul>
          <li>
              <a href="https://apps.crp.to/decrypt">
                  <i class="fa fa-unlock" aria-hidden="true"></i>
              </a>
          </li>
          <li>
              <a href="https://apps.crp.to/encrypt">
                  <i class="fa fa-lock" aria-hidden="true"></i>
              </a>
          </li>
          <li>
              <a href="https://apps.crp.to/decrypt-file">
                  <i class="fa fa-file-text" aria-hidden="true"></i>
              </a>
          </li>
          <li class="yui3-menu-active">
              <a href="https://apps.crp.to/encrypt-file">
                  <i class="fa fa-file-archive-o" aria-hidden="true"></i>
              </a>
          </li>
        </ul>
     <span class="yui3-menu-heading">Links</span>
      <ul>
          <li>
              <a href="https://apps.crp.to">
                  <i class="fa fa-home" aria-hidden="true"></i>
              </a>
          </li>
          <li>
              <a href="https://docs.crp.to/webcrypt.html">
                  <i class="fa fa-question" aria-hidden="true"></i>
              </a>
          </li>
          <li>
              <a href="https://docs.crp.to/">
                  <i class="fa fa-book" aria-hidden="true"></i>
              </a>
          </li>
          <li>
              <a href="https://onlykey.io">
                  <i class="fa fa-shopping-cart" aria-hidden="true"></i>
              </a>
          </li>
      </ul>
  </div>
  <div class="header yui3-u-1">
        <br>
        <h1>
        <i class="fa fa-search fa-2x" aria-hidden="true"></i></i> <i class="fa fa-long-arrow-right fa-2x" aria-hidden="true"></i> <i class="fa fa-user fa-2x" aria-hidden="true"></i>
    </div>
    <h4><font size="+2">Find Keybase user to send encrypted messages and files using
        <a href="https://onlykey.io" target="_blank">OnlyKey</a> and <a href="https://keybase.io/kbpgp" target="_blank">Keybase PGP</a></font></h4>
        <div id="container">
        <fieldset>
            <textarea placeholder="Enter username to search for..." rows="1" id="user"></textarea>
            <select id="sites" name="Site to search">
              <option value="keybase">Searching Keybase</option>
              <option value="protonmail">Searching Protonmail</option>
              <!--<option value="web">Web Domain (i.e. mywebsite.com)</option>
              <option value="twitter">Twitter</option>
              <option value="github">Github</option>
              <option value="reddit">Reddit</option>
              <option value="hackernews">Hackernews</option>
              <option value="key_fingerprint">PGP Key Fingerprint</option>-->
            </select>
            <button type="submit" id="submit" value="Search">Search For User</button>
            <div id="" class="yui3-u-1 block">
              <div class="block-inner outline">
                <div id="results">
                  <h3>Search results Displayed Here...</h3>
                </div>
              </div>
            </div>
        </fieldset>
        </div>
  <script type="text/javascript" src="bundle.4aac6256d8df7910f6b2.js"></script></body>

</html>
